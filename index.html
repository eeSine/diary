<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„æ—¥è®°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .search-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .search-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .search-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e0e6ed;
            border-radius: 8px;
            font-size: 16px;
            outline: none;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .search-btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            min-width: 100px;
        }

        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .search-btn:active {
            transform: translateY(0);
        }

        .search-info {
            display: none;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 14px;
            color: #666;
        }

        .diaries-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .diary-entry {
            border: 1px solid #e0e6ed;
            border-radius: 12px;
            margin-bottom: 20px;
            overflow: hidden;
            transition: all 0.3s ease;
            background: white;
        }

        .diary-entry:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .diary-entry.hidden {
            display: none;
        }

        .diary-entry.highlighted {
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
        }

        .diary-header {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 15px 20px;
            border-bottom: 1px solid #e0e6ed;
        }

        .diary-date {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }

        .diary-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        .diary-content {
            padding: 20px;
        }

        .diary-content p {
            margin-bottom: 12px;
        }

        .diary-content h2, .diary-content h3 {
            margin-bottom: 10px;
            color: #333;
        }

        .diary-content ul, .diary-content ol {
            margin-left: 20px;
            margin-bottom: 12px;
        }

        .diary-content blockquote {
            border-left: 4px solid #667eea;
            padding-left: 16px;
            margin: 12px 0;
            color: #666;
            font-style: italic;
        }

        .highlight {
            background-color: #ffeb3b;
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: 600;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            color: #666;
            display: none;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header h1 {
                font-size: 2em;
            }

            .search-container {
                flex-direction: column;
            }

            .search-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“– æˆ‘çš„æ—¥è®°</h1>
            <p>è®°å½•ç”Ÿæ´»çš„ç¾å¥½ç¬é—´</p>
        </div>

        <div class="search-section">
            <div class="search-container">
                <input type="text" class="search-input" placeholder="æœç´¢æ—¥è®°å†…å®¹..." id="searchInput">
                <button class="search-btn" id="searchBtn">ğŸ” æœç´¢</button>
            </div>
            <div class="search-info" id="searchInfo"></div>
        </div>

        <div class="diaries-section">
            <div class="loading" id="loading">æ­£åœ¨åŠ è½½æ—¥è®°...</div>
            <div class="no-results" id="noResults">
                <p>ğŸ˜” æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„æ—¥è®°</p>
                <p>è¯•è¯•å…¶ä»–å…³é”®è¯å§</p>
            </div>
            <div id="diariesContainer"></div>
        </div>
    </div>

    <script>
        // GitHub é…ç½®
        const GITHUB_CONFIG = {
            owner: 'eeSine',  // æ›¿æ¢ä¸ºä½ çš„GitHubç”¨æˆ·å
            repo: 'diary',    // æ›¿æ¢ä¸ºä½ çš„æ—¥è®°ä»“åº“å
            branch: 'main'    // åˆ†æ”¯å
        };

        let allDiaries = [];
        let currentSearchTerm = '';

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadDiaries();
            setupSearch();
        });

        // è®¾ç½®æœç´¢åŠŸèƒ½
        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            const searchBtn = document.getElementById('searchBtn');

            // ç‚¹å‡»æœç´¢æŒ‰é’®
            searchBtn.addEventListener('click', performSearch);

            // å›è½¦é”®æœç´¢
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    performSearch();
                }
            });

            // å®æ—¶æœç´¢ï¼ˆå¯é€‰ï¼‰
            searchInput.addEventListener('input', debounce(performSearch, 300));
        }

        // æ‰§è¡Œæœç´¢
        function performSearch() {
            const searchTerm = document.getElementById('searchInput').value.trim();
            currentSearchTerm = searchTerm;

            const searchInfo = document.getElementById('searchInfo');
            const noResults = document.getElementById('noResults');
            const diariesContainer = document.getElementById('diariesContainer');

            if (!searchTerm) {
                // æ¸…ç©ºæœç´¢ï¼Œæ˜¾ç¤ºæ‰€æœ‰æ—¥è®°
                showAllDiaries();
                searchInfo.style.display = 'none';
                noResults.style.display = 'none';
                return;
            }

            // æœç´¢æ—¥è®°
            const filteredDiaries = searchDiaries(searchTerm);
            
            if (filteredDiaries.length === 0) {
                searchInfo.textContent = `æ²¡æœ‰æ‰¾åˆ°åŒ…å« "${searchTerm}" çš„æ—¥è®°`;
                searchInfo.style.display = 'block';
                noResults.style.display = 'block';
                diariesContainer.style.display = 'none';
            } else {
                searchInfo.textContent = `æ‰¾åˆ° ${filteredDiaries.length} æ¡åŒ…å« "${searchTerm}" çš„æ—¥è®°`;
                searchInfo.style.display = 'block';
                noResults.style.display = 'none';
                diariesContainer.style.display = 'block';
                displayDiaries(filteredDiaries, searchTerm);
            }
        }

        // æœç´¢æ—¥è®°å†…å®¹
        function searchDiaries(searchTerm) {
            const term = searchTerm.toLowerCase();
            return allDiaries.filter(diary => {
                return diary.title.toLowerCase().includes(term) ||
                       diary.content.toLowerCase().includes(term) ||
                       diary.date.includes(term);
            });
        }

        // é«˜äº®æœç´¢å…³é”®è¯
        function highlightText(text, searchTerm) {
            if (!searchTerm) return text;
            
            const regex = new RegExp(`(${escapeRegex(searchTerm)})`, 'gi');
            return text.replace(regex, '<span class="highlight">$1</span>');
        }

        // è½¬ä¹‰æ­£åˆ™è¡¨è¾¾å¼ç‰¹æ®Šå­—ç¬¦
        function escapeRegex(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }

        // æ˜¾ç¤ºæ‰€æœ‰æ—¥è®°
        function showAllDiaries() {
            displayDiaries(allDiaries, '');
        }

        // é˜²æŠ–å‡½æ•°
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // åŠ è½½æ—¥è®°
        async function loadDiaries() {
            try {
                const loading = document.getElementById('loading');
                loading.style.display = 'block';

                // è·å–ç›®å½•ç»“æ„
                const diariesData = await fetchDiariesFromGitHub();
                allDiaries = diariesData;

                loading.style.display = 'none';
                
                if (allDiaries.length === 0) {
                    document.getElementById('noResults').style.display = 'block';
                    document.getElementById('noResults').innerHTML = '<p>ğŸ“ è¿˜æ²¡æœ‰æ—¥è®°ï¼Œå¼€å§‹å†™ç¬¬ä¸€ç¯‡å§ï¼</p>';
                } else {
                    displayDiaries(allDiaries, '');
                }
            } catch (error) {
                console.error('åŠ è½½æ—¥è®°å¤±è´¥:', error);
                document.getElementById('loading').innerHTML = '<p>âŒ åŠ è½½æ—¥è®°å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥</p>';
            }
        }

        // ä»GitHubè·å–æ—¥è®°æ•°æ®
        async function fetchDiariesFromGitHub() {
            const diaries = [];
            
            try {
                // è·å–diariesç›®å½•
                const response = await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/diaries`);
                if (!response.ok) throw new Error('Failed to fetch directories');
                
                const directories = await response.json();
                
                // éå†æœˆä»½ç›®å½•
                for (const dir of directories) {
                    if (dir.type === 'dir') {
                        const monthResponse = await fetch(dir.url);
                        const files = await monthResponse.json();
                        
                        // å¤„ç†æ¯ä¸ªæ—¥è®°æ–‡ä»¶
                        for (const file of files) {
                            if (file.name.endsWith('.md')) {
                                const fileResponse = await fetch(file.download_url);
                                const content = await fileResponse.text();
                                
                                // è§£ææ–‡ä»¶åå’Œå†…å®¹
                                const fileName = file.name.replace('.md', '');
                                const parts = fileName.split('_');
                                const date = parts[0];
                                const title = parts.slice(1).join('_');
                                
                                diaries.push({
                                    date: date,
                                    title: title,
                                    content: content,
                                    fileName: file.name,
                                    path: file.path
                                });
                            }
                        }
                    }
                }
                
                // æŒ‰æ—¥æœŸæ’åº
                diaries.sort((a, b) => new Date(b.date) - new Date(a.date));
                
            } catch (error) {
                console.error('è·å–æ—¥è®°æ•°æ®å¤±è´¥:', error);
                // å¦‚æœè·å–å¤±è´¥ï¼Œè¿”å›ç¤ºä¾‹æ•°æ®
                return getSampleDiaries();
            }
            
            return diaries;
        }

        // è·å–ç¤ºä¾‹æ•°æ®ï¼ˆç”¨äºæ¼”ç¤ºï¼‰
        function getSampleDiaries() {
            return [
                {
                    date: '2025-08-20',
                    title: 'å­¦ä¹ æ–°æŠ€æœ¯',
                    content: `# å­¦ä¹ æ–°æŠ€æœ¯

ä»Šå¤©å­¦ä¹ äº†å¾ˆå¤šæ–°çš„æŠ€æœ¯çŸ¥è¯†ï¼š

## ä¸»è¦å†…å®¹
- GitHub Actionsçš„ä½¿ç”¨æ–¹æ³•
- Vercel Functionsçš„éƒ¨ç½²æµç¨‹  
- Markdownè¯­æ³•çš„é«˜çº§ç”¨æ³•

> å­¦è€Œæ—¶ä¹ ä¹‹ï¼Œä¸äº¦è¯´ä¹ï¼Ÿ

æ„Ÿè§‰æ”¶è·å¾ˆå¤§ï¼Œæ˜å¤©ç»§ç»­åŠªåŠ›ï¼ğŸ‰`,
                    fileName: '2025-08-20_å­¦ä¹ æ–°æŠ€æœ¯.md'
                },
                {
                    date: '2025-08-19',
                    title: 'é¡¹ç›®å¼€å‘æ€»ç»“',
                    content: `# é¡¹ç›®å¼€å‘æ€»ç»“

ä»Šå¤©å®Œæˆäº†æ—¥è®°ç³»ç»Ÿçš„æœç´¢åŠŸèƒ½å¼€å‘ã€‚

## å®ç°çš„åŠŸèƒ½
1. å…³é”®è¯æœç´¢
2. æœç´¢ç»“æœé«˜äº®
3. å®æ—¶æœç´¢åé¦ˆ

é‡åˆ°äº†ä¸€äº›æŠ€æœ¯éš¾ç‚¹ï¼Œä½†æœ€ç»ˆéƒ½è§£å†³äº†ã€‚ä»£ç è´¨é‡è¿˜éœ€è¦è¿›ä¸€æ­¥ä¼˜åŒ–ã€‚

**æ˜å¤©çš„è®¡åˆ’ï¼š**
- ä¼˜åŒ–ç”¨æˆ·ç•Œé¢
- æ·»åŠ æ›´å¤šåŠŸèƒ½
- æµ‹è¯•å’Œè°ƒè¯•`,
                    fileName: '2025-08-19_é¡¹ç›®å¼€å‘æ€»ç»“.md'
                },
                {
                    date: '2025-08-18',
                    title: 'ç¾å¥½çš„ä¸€å¤©',
                    content: `# ç¾å¥½çš„ä¸€å¤©

ä»Šå¤©å¤©æ°”å¾ˆå¥½ï¼Œå¿ƒæƒ…ä¹Ÿå¾ˆæ£’ï¼

æ—©ä¸Šå»å…¬å›­è·‘æ­¥ï¼Œçœ‹åˆ°äº†ç¾ä¸½çš„æ—¥å‡ºã€‚ä¸‹åˆå’Œæœ‹å‹ä¸€èµ·å–å’–å•¡ï¼ŒèŠäº†å¾ˆå¤šæœ‰è¶£çš„è¯é¢˜ã€‚

**ä»Šå¤©çš„æ„Ÿæ‚Ÿï¼š**
ç”Ÿæ´»ä¸­çš„ç¾å¥½æ€»æ˜¯åœ¨ä¸ç»æ„é—´å‡ºç°ï¼Œè¦å­¦ä¼šçæƒœæ¯ä¸€ä¸ªå½“ä¸‹çš„æ—¶åˆ»ã€‚

æ˜å¤©ä¹Ÿè¦ä¿æŒè¿™æ ·çš„å¥½å¿ƒæƒ…ï¼ğŸ˜Š`,
                    fileName: '2025-08-18_ç¾å¥½çš„ä¸€å¤©.md'
                }
            ];
        }

        // æ˜¾ç¤ºæ—¥è®°åˆ—è¡¨
        function displayDiaries(diaries, searchTerm) {
            const container = document.getElementById('diariesContainer');
            container.innerHTML = '';
            
            diaries.forEach(diary => {
                const diaryElement = createDiaryElement(diary, searchTerm);
                container.appendChild(diaryElement);
            });
        }

        // åˆ›å»ºæ—¥è®°å…ƒç´ 
        function createDiaryElement(diary, searchTerm) {
            const div = document.createElement('div');
            div.className = 'diary-entry';
            
            // æ ¼å¼åŒ–æ—¥æœŸ
            const formattedDate = formatDate(diary.date);
            
            // å¤„ç†å†…å®¹ï¼Œç®€åŒ–markdownæ˜¾ç¤º
            const processedContent = processMarkdownContent(diary.content);
            
            div.innerHTML = `
                <div class="diary-header">
                    <div class="diary-date">${formattedDate}</div>
                    <div class="diary-title">${highlightText(diary.title, searchTerm)}</div>
                </div>
                <div class="diary-content">
                    ${highlightText(processedContent, searchTerm)}
                </div>
            `;
            
            return div;
        }

        // æ ¼å¼åŒ–æ—¥æœŸ
        function formatDate(dateString) {
            const date = new Date(dateString);
            const options = { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                weekday: 'long'
            };
            return date.toLocaleDateString('zh-CN', options);
        }

        // å¤„ç†Markdownå†…å®¹
        function processMarkdownContent(content) {
            // ç®€å•çš„markdownå¤„ç†
            let processed = content;
            
            // å¤„ç†æ ‡é¢˜
            processed = processed.replace(/^### (.*$)/gm, '<h3>$1</h3>');
            processed = processed.replace(/^## (.*$)/gm, '<h2>$1</h2>');
            processed = processed.replace(/^# (.*$)/gm, '<h1>$1</h1>');
            
            // å¤„ç†ç²—ä½“å’Œæ–œä½“
            processed = processed.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            processed = processed.replace(/\*(.*?)\*/g, '<em>$1</em>');
            
            // å¤„ç†å¼•ç”¨
            processed = processed.replace(/^> (.*$)/gm, '<blockquote>$1</blockquote>');
            
            // å¤„ç†åˆ—è¡¨
            processed = processed.replace(/^- (.*$)/gm, '<li>$1</li>');
            processed = processed.replace(/^(\d+)\. (.*$)/gm, '<li>$1. $2</li>');
            
            // å¤„ç†æ¢è¡Œ
            processed = processed.replace(/\n\n/g, '</p><p>');
            processed = '<p>' + processed + '</p>';
            
            // æ¸…ç†ç©ºæ®µè½
            processed = processed.replace(/<p><\/p>/g, '');
            processed = processed.replace(/<p>\s*<h/g, '<h');
            processed = processed.replace(/h>\s*<\/p>/g, 'h>');
            processed = processed.replace(/<p>\s*<blockquote/g, '<blockquote');
            processed = processed.replace(/blockquote>\s*<\/p>/g, 'blockquote>');
            
            return processed;
        }
    </script>
</body>
</html>
