<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的日记</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .search-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .search-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .search-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e0e6ed;
            border-radius: 8px;
            font-size: 16px;
            outline: none;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .search-btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            min-width: 100px;
        }

        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .search-btn:active {
            transform: translateY(0);
        }

        .search-info {
            display: none;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 14px;
            color: #666;
        }

        .diaries-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .diary-entry {
            border: 1px solid #e0e6ed;
            border-radius: 12px;
            margin-bottom: 20px;
            overflow: hidden;
            transition: all 0.3s ease;
            background: white;
        }

        .diary-entry:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .diary-entry.hidden {
            display: none;
        }

        .diary-entry.highlighted {
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
        }

        .diary-header {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 15px 20px;
            border-bottom: 1px solid #e0e6ed;
        }

        .diary-date {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }

        .diary-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        .diary-content {
            padding: 20px;
        }

        .diary-content p {
            margin-bottom: 12px;
        }

        .diary-content h2, .diary-content h3 {
            margin-bottom: 10px;
            color: #333;
        }

        .diary-content ul, .diary-content ol {
            margin-left: 20px;
            margin-bottom: 12px;
        }

        .diary-content blockquote {
            border-left: 4px solid #667eea;
            padding-left: 16px;
            margin: 12px 0;
            color: #666;
            font-style: italic;
        }

        .highlight {
            background-color: #ffeb3b;
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: 600;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            color: #666;
            display: none;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header h1 {
                font-size: 2em;
            }

            .search-container {
                flex-direction: column;
            }

            .search-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📖 我的日记</h1>
            <p>记录生活的美好瞬间</p>
        </div>

        <div class="search-section">
            <div class="search-container">
                <input type="text" class="search-input" placeholder="搜索日记内容..." id="searchInput">
                <button class="search-btn" id="searchBtn">🔍 搜索</button>
            </div>
            <div class="search-info" id="searchInfo"></div>
        </div>

        <div class="diaries-section">
            <div class="loading" id="loading">正在加载日记...</div>
            <div class="no-results" id="noResults">
                <p>😔 没有找到匹配的日记</p>
                <p>试试其他关键词吧</p>
            </div>
            <div id="diariesContainer"></div>
        </div>
    </div>

    <script>
        // GitHub 配置
        const GITHUB_CONFIG = {
            owner: 'eeSine',  // 替换为你的GitHub用户名
            repo: 'diary',    // 替换为你的日记仓库名
            branch: 'main'    // 分支名
        };

        let allDiaries = [];
        let currentSearchTerm = '';

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            loadDiaries();
            setupSearch();
        });

        // 设置搜索功能
        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            const searchBtn = document.getElementById('searchBtn');

            // 点击搜索按钮
            searchBtn.addEventListener('click', performSearch);

            // 回车键搜索
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    performSearch();
                }
            });

            // 实时搜索（可选）
            searchInput.addEventListener('input', debounce(performSearch, 300));
        }

        // 执行搜索
        function performSearch() {
            const searchTerm = document.getElementById('searchInput').value.trim();
            currentSearchTerm = searchTerm;

            const searchInfo = document.getElementById('searchInfo');
            const noResults = document.getElementById('noResults');
            const diariesContainer = document.getElementById('diariesContainer');

            if (!searchTerm) {
                // 清空搜索，显示所有日记
                showAllDiaries();
                searchInfo.style.display = 'none';
                noResults.style.display = 'none';
                return;
            }

            // 搜索日记
            const filteredDiaries = searchDiaries(searchTerm);
            
            if (filteredDiaries.length === 0) {
                searchInfo.textContent = `没有找到包含 "${searchTerm}" 的日记`;
                searchInfo.style.display = 'block';
                noResults.style.display = 'block';
                diariesContainer.style.display = 'none';
            } else {
                searchInfo.textContent = `找到 ${filteredDiaries.length} 条包含 "${searchTerm}" 的日记`;
                searchInfo.style.display = 'block';
                noResults.style.display = 'none';
                diariesContainer.style.display = 'block';
                displayDiaries(filteredDiaries, searchTerm);
            }
        }

        // 搜索日记内容
        function searchDiaries(searchTerm) {
            const term = searchTerm.toLowerCase();
            return allDiaries.filter(diary => {
                return diary.title.toLowerCase().includes(term) ||
                       diary.content.toLowerCase().includes(term) ||
                       diary.date.includes(term);
            });
        }

        // 高亮搜索关键词
        function highlightText(text, searchTerm) {
            if (!searchTerm) return text;
            
            const regex = new RegExp(`(${escapeRegex(searchTerm)})`, 'gi');
            return text.replace(regex, '<span class="highlight">$1</span>');
        }

        // 转义正则表达式特殊字符
        function escapeRegex(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }

        // 显示所有日记
        function showAllDiaries() {
            displayDiaries(allDiaries, '');
        }

        // 防抖函数
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // 加载日记
        async function loadDiaries() {
            try {
                const loading = document.getElementById('loading');
                loading.style.display = 'block';

                // 获取目录结构
                const diariesData = await fetchDiariesFromGitHub();
                allDiaries = diariesData;

                loading.style.display = 'none';
                
                if (allDiaries.length === 0) {
                    document.getElementById('noResults').style.display = 'block';
                    document.getElementById('noResults').innerHTML = '<p>📝 还没有日记，开始写第一篇吧！</p>';
                } else {
                    displayDiaries(allDiaries, '');
                }
            } catch (error) {
                console.error('加载日记失败:', error);
                document.getElementById('loading').innerHTML = '<p>❌ 加载日记失败，请检查网络连接</p>';
            }
        }

        // 从GitHub获取日记数据
        async function fetchDiariesFromGitHub() {
            const diaries = [];
            
            try {
                // 获取diaries目录
                const response = await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/diaries`);
                if (!response.ok) throw new Error('Failed to fetch directories');
                
                const directories = await response.json();
                
                // 遍历月份目录
                for (const dir of directories) {
                    if (dir.type === 'dir') {
                        const monthResponse = await fetch(dir.url);
                        const files = await monthResponse.json();
                        
                        // 处理每个日记文件
                        for (const file of files) {
                            if (file.name.endsWith('.md')) {
                                const fileResponse = await fetch(file.download_url);
                                const content = await fileResponse.text();
                                
                                // 解析文件名和内容
                                const fileName = file.name.replace('.md', '');
                                const parts = fileName.split('_');
                                const date = parts[0];
                                const title = parts.slice(1).join('_');
                                
                                diaries.push({
                                    date: date,
                                    title: title,
                                    content: content,
                                    fileName: file.name,
                                    path: file.path
                                });
                            }
                        }
                    }
                }
                
                // 按日期排序
                diaries.sort((a, b) => new Date(b.date) - new Date(a.date));
                
            } catch (error) {
                console.error('获取日记数据失败:', error);
                // 如果获取失败，返回示例数据
                return getSampleDiaries();
            }
            
            return diaries;
        }

        // 获取示例数据（用于演示）
        function getSampleDiaries() {
            return [
                {
                    date: '2025-08-20',
                    title: '学习新技术',
                    content: `# 学习新技术

今天学习了很多新的技术知识：

## 主要内容
- GitHub Actions的使用方法
- Vercel Functions的部署流程  
- Markdown语法的高级用法

> 学而时习之，不亦说乎？

感觉收获很大，明天继续努力！🎉`,
                    fileName: '2025-08-20_学习新技术.md'
                },
                {
                    date: '2025-08-19',
                    title: '项目开发总结',
                    content: `# 项目开发总结

今天完成了日记系统的搜索功能开发。

## 实现的功能
1. 关键词搜索
2. 搜索结果高亮
3. 实时搜索反馈

遇到了一些技术难点，但最终都解决了。代码质量还需要进一步优化。

**明天的计划：**
- 优化用户界面
- 添加更多功能
- 测试和调试`,
                    fileName: '2025-08-19_项目开发总结.md'
                },
                {
                    date: '2025-08-18',
                    title: '美好的一天',
                    content: `# 美好的一天

今天天气很好，心情也很棒！

早上去公园跑步，看到了美丽的日出。下午和朋友一起喝咖啡，聊了很多有趣的话题。

**今天的感悟：**
生活中的美好总是在不经意间出现，要学会珍惜每一个当下的时刻。

明天也要保持这样的好心情！😊`,
                    fileName: '2025-08-18_美好的一天.md'
                }
            ];
        }

        // 显示日记列表
        function displayDiaries(diaries, searchTerm) {
            const container = document.getElementById('diariesContainer');
            container.innerHTML = '';
            
            diaries.forEach(diary => {
                const diaryElement = createDiaryElement(diary, searchTerm);
                container.appendChild(diaryElement);
            });
        }

        // 创建日记元素
        function createDiaryElement(diary, searchTerm) {
            const div = document.createElement('div');
            div.className = 'diary-entry';
            
            // 格式化日期
            const formattedDate = formatDate(diary.date);
            
            // 处理内容，简化markdown显示
            const processedContent = processMarkdownContent(diary.content);
            
            div.innerHTML = `
                <div class="diary-header">
                    <div class="diary-date">${formattedDate}</div>
                    <div class="diary-title">${highlightText(diary.title, searchTerm)}</div>
                </div>
                <div class="diary-content">
                    ${highlightText(processedContent, searchTerm)}
                </div>
            `;
            
            return div;
        }

        // 格式化日期
        function formatDate(dateString) {
            const date = new Date(dateString);
            const options = { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                weekday: 'long'
            };
            return date.toLocaleDateString('zh-CN', options);
        }

        // 处理Markdown内容
        function processMarkdownContent(content) {
            // 简单的markdown处理
            let processed = content;
            
            // 处理标题
            processed = processed.replace(/^### (.*$)/gm, '<h3>$1</h3>');
            processed = processed.replace(/^## (.*$)/gm, '<h2>$1</h2>');
            processed = processed.replace(/^# (.*$)/gm, '<h1>$1</h1>');
            
            // 处理粗体和斜体
            processed = processed.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            processed = processed.replace(/\*(.*?)\*/g, '<em>$1</em>');
            
            // 处理引用
            processed = processed.replace(/^> (.*$)/gm, '<blockquote>$1</blockquote>');
            
            // 处理列表
            processed = processed.replace(/^- (.*$)/gm, '<li>$1</li>');
            processed = processed.replace(/^(\d+)\. (.*$)/gm, '<li>$1. $2</li>');
            
            // 处理换行
            processed = processed.replace(/\n\n/g, '</p><p>');
            processed = '<p>' + processed + '</p>';
            
            // 清理空段落
            processed = processed.replace(/<p><\/p>/g, '');
            processed = processed.replace(/<p>\s*<h/g, '<h');
            processed = processed.replace(/h>\s*<\/p>/g, 'h>');
            processed = processed.replace(/<p>\s*<blockquote/g, '<blockquote');
            processed = processed.replace(/blockquote>\s*<\/p>/g, 'blockquote>');
            
            return processed;
        }
    </script>
</body>
</html>
